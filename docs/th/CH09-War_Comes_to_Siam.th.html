<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ch09-war_comes_to_siam.th – The Dictionary Maker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="sec-war-comes-siam" class="level1">
<h1>War Comes to Siam</h1>
<section id="december-8-1941-the-japanese-invasion" class="level2">
<h2 class="anchored" data-anchor-id="december-8-1941-the-japanese-invasion">December 8, 1941: The Japanese Invasion</h2>
<p>The Japanese invasion of Thailand on December 8, 1941, brought the global war directly to Siam’s shores, transforming the kingdom into a reluctant ally of the Axis powers and dramatically altering the fate of the political prisoners.</p>
<p>Although the prisoners at the Talo Udang camp on Tarutao were shut out from the outside world, they were fully aware that a war was raging beyond their island paradise. The isolation that had seemed so complete when they first arrived (as described in <strong>?@sec-tarutao-exile</strong>) proved to be less absolute than the authorities had intended. Information filtered in through prison guards, supply boats, and the occasional visitor, creating a picture of a world in upheaval that would ultimately reach even their remote corner of the Andaman Sea.</p>
<p>The prisoners learned from their guards that Siam had been invaded and occupied by the Japanese, and that the kingdom had put up a heroic stand against the invaders in the southern peninsula where many soldiers’ lives were lost on December 8 and 9, 1941. Being as close as they were to the Malayan border, the prisoners frequently heard the sound of heavy artillery, and as they cocked their ears to listen, they knew instinctively that it was not the sound of thunder, as the rains never came during that season. The war that had been building across Asia (as outlined in <strong>?@sec-rising-storm</strong>) had finally arrived at Thailand’s doorstep with devastating force.</p>
<p>The transformation of their world from the relative tranquility they had achieved on Tarutao to the uncertainties of wartime brought new challenges that tested both their physical survival and their intellectual resilience. For So Sethaputra, the war represented not merely a political catastrophe but a direct threat to the dictionary project that had sustained him through years of imprisonment.</p>
</section>
<section id="the-swift-collapse-of-resistance" class="level2">
<h2 class="anchored" data-anchor-id="the-swift-collapse-of-resistance">The Swift Collapse of Resistance</h2>
<p>The Japanese invasion of Thailand demonstrated the futility of the kingdom’s attempts to maintain neutrality in an increasingly polarized world. Despite years of careful diplomatic maneuvering and military preparation, Thailand’s resistance lasted only hours before the government was forced to accept the reality of Japanese military superiority. The speed of the collapse shocked even those who had predicted that Thailand would eventually be drawn into the Japanese sphere of influence.</p>
<p>The invasion began simultaneously at multiple points along Thailand’s coastline and borders, with Japanese forces landing at Songkhla, Pattani, and Chumphon while other units crossed from Japanese-occupied Indochina. The coordinated nature of the assault demonstrated the thoroughness of Japanese planning and the effectiveness of their intelligence gathering. Thai military units, despite their modern equipment and training, found themselves overwhelmed by the scale and precision of the Japanese operation.</p>
<p>The psychological impact of the invasion was as devastating as its military consequences. For a kingdom that had maintained its independence for centuries while neighboring countries fell under European colonial control, the reality of foreign occupation was a profound national humiliation. The Thai military leadership that had come to power in 1932 with promises of national strength and independence found themselves forced to accept the role of junior partners in the Japanese empire.</p>
<p>The political prisoners on Tarutao, despite their opposition to the revolutionary government, felt the shame of their country’s defeat as keenly as any patriotic Thai citizen. Their European education and international perspective gave them a clearer understanding than most of what Japanese occupation would mean for Thailand’s future. They recognized that their country had become a pawn in a global conflict whose outcome would determine the fate of Asian civilization for generations to come.</p>
</section>
<section id="the-bombing-of-bangkok" class="level2">
<h2 class="anchored" data-anchor-id="the-bombing-of-bangkok">The Bombing of Bangkok</h2>
<p>The transformation of Thailand from neutral kingdom to active belligerent brought the war directly to the Thai people in ways that peaceful occupation might not have achieved. On January 8, 1942, Bangkok was bombed by British aircraft, with the Hua Lampong railway station area being badly hit. The bombing marked Thailand’s definitive entry into the global conflict and demonstrated that the kingdom would not be spared the devastation that was consuming much of the world.</p>
<p>For the political prisoners on Tarutao, news of the bombing brought the war home in the most personal way possible. Many had family and friends in Bangkok who were now exposed to the dangers of aerial bombardment. The city that had been the center of their professional and social lives was now a target for enemy aircraft, its familiar landmarks potentially reduced to rubble by forces beyond Thailand’s control.</p>
<p>The bombing also had immediate practical consequences for So’s dictionary project. The attack on Bangkok disrupted the communications and transportation networks that had enabled the continued publication of his work. More ominously, it created an environment of suspicion and paranoia that made any form of clandestine publishing extremely dangerous for all involved.</p>
<p>The declaration of martial law following the bombing brought new restrictions on all forms of communication and commerce. The prisons came under stricter supervision as the government became increasingly concerned about potential sabotage and fifth-column activities. For political prisoners already viewed with suspicion, the wartime atmosphere created additional layers of surveillance and control that made their continued intellectual activities even more precarious.</p>
</section>
<section id="the-death-of-phraya-nibhon" class="level2">
<h2 class="anchored" data-anchor-id="the-death-of-phraya-nibhon">The Death of Phraya Nibhon</h2>
<p>The most devastating personal blow to So’s dictionary project came with the death of his publisher, Phraya Nibhon Pojanart, who was killed during one of the air raids on Bangkok. Phraya Nibhon had been more than a commercial partner; he had been the courageous intermediary who made it possible for a political prisoner to continue contributing to Thai education despite his confinement. His death represented not only a personal loss but the destruction of the carefully constructed network that had enabled the dictionary’s publication.</p>
<p>Phraya Nibhon’s death occurred at a particularly crucial moment in the dictionary project’s development. So had completed his comprehensive library edition and was working on a more compact desk-sized version designed specifically for high school students. This portable edition represented the culmination of years of refinement and adaptation, incorporating lessons learned from the reception of the original installments and feedback from educators who had used the work in their classrooms.</p>
<p>The timing of the publisher’s death meant that So’s completed portable edition could not be published immediately. The manuscript, representing years of additional work beyond the original dictionary, would have to wait for more favorable circumstances and a new publisher willing to risk the dangers associated with handling the work of a political prisoner. For So, this delay represented not merely a professional setback but the potential loss of income that his family desperately needed for survival.</p>
<p>The personal impact of Phraya Nibhon’s death on So was profound. The publisher had been one of the few people outside his immediate family who fully understood and supported the dictionary project’s educational mission. His willingness to risk his business and potentially his freedom to bring So’s work to the Thai people had provided validation that the years of imprisonment and scholarly labor were producing something of genuine value to society.</p>
</section>
<section id="the-transformation-of-prison-conditions" class="level2">
<h2 class="anchored" data-anchor-id="the-transformation-of-prison-conditions">The Transformation of Prison Conditions</h2>
<p>The war brought dramatic changes to the conditions under which the political prisoners lived and worked. The relatively liberal policies that had characterized their treatment during the early years of their confinement were replaced by much stricter security measures as the government became increasingly paranoid about potential threats to internal security. The educational and cultural activities that had flourished in both Bang Kwang and Tarutao were viewed with new suspicion as possible covers for seditious activities.</p>
<p>Security searches became more frequent and thorough, making it increasingly difficult to maintain the secrecy essential to So’s continued scholarly work. The guards, who had previously been content to ignore activities they did not understand, received new instructions to report any unusual behavior or suspicious materials. The informal arrangements that had enabled prisoners to obtain writing materials, reference books, and other necessities for intellectual work became much more dangerous to maintain.</p>
<p>The economic pressures created by Thailand’s entry into the war also affected prison conditions. Resources that had previously been allocated to prisoner welfare were redirected to military purposes, leading to reduced food rations and deteriorating living conditions. The semi-autonomous community that the political prisoners had created on Tarutao found itself under increasing pressure as supplies became scarce and external support more difficult to obtain.</p>
<p>Most significantly, the war altered the fundamental relationship between the political prisoners and the state. During peacetime, their confinement had been justified primarily as punishment for past political activities. The war transformed them into potential security threats whose continued existence near strategically important areas represented an unacceptable risk to national defense. This shift in perception would have profound consequences for their future treatment and location.</p>
</section>
<section id="the-strategic-implications-of-imprisonment" class="level2">
<h2 class="anchored" data-anchor-id="the-strategic-implications-of-imprisonment">The Strategic Implications of Imprisonment</h2>
<p>The Japanese occupation of Southeast Asia created new strategic considerations that affected every aspect of Thailand’s domestic policy, including the management of political prisoners. The proximity of Tarutao to the Malayan border, which had originally made it an ideal prison location due to its isolation, now made it a potential liability in the context of regional warfare. The presence of educated, potentially disloyal prisoners near areas of military importance became a security concern that demanded resolution.</p>
<p>Intelligence reports reaching Bangkok suggested that Allied forces were planning operations in the Andaman Sea region that could potentially involve attempts to liberate political prisoners or recruit them for anti-Japanese activities. Whether or not these reports were accurate, they reflected the government’s growing paranoia about the loyalty of the Western-educated elite and their potential value to enemy forces seeking local allies.</p>
<p>The prisoners’ European educations and international connections, which had once been viewed merely as evidence of their unsuitability for the new Thailand, were now seen as qualifications that could make them valuable assets to Allied intelligence services. Their knowledge of Thai society, their language skills, and their potential grievances against the current government made them ideal candidates for recruitment by enemy agents seeking to establish resistance networks within Thailand.</p>
<p>The continuous Japanese sea and air patrols over the thousands of islands that made up the archipelago of the Andaman Sea provided evidence of the region’s strategic importance and the reality of the military threat. The prisoners could see and hear the aircraft that patrolled their waters, constant reminders that they were no longer isolated from the global conflict but rather situated at one of its potential focal points.</p>
</section>
<section id="the-decision-to-transfer-again" class="level2">
<h2 class="anchored" data-anchor-id="the-decision-to-transfer-again">The Decision to Transfer Again</h2>
<p>By 1943, the tide of war was beginning to turn, and aware that the Allies would soon be in control of the Andaman Sea, the government decided to move the political prisoners once again. The decision reflected both military necessity and political calculation: the prisoners had to be moved away from areas where they might be liberated by Allied forces, but they also had to be relocated in a way that would not appear to be a response to military pressure.</p>
<p>The choice of Koh Tao, a tiny uninhabited island in the Gulf of Siam, as the new prison location demonstrated the government’s determination to maintain absolute control over the political prisoners regardless of changing military circumstances. The island’s position in the Gulf of Siam, far from the main theaters of war but still under firm Thai government control, would eliminate the security risks associated with their proximity to combat zones.</p>
<p>There were only fifty-five political prisoners left on Tarutao when the transfer decision was made. The relatively small number reflected both the success of earlier escape attempts and the natural attrition that had occurred during years of imprisonment under tropical conditions. The anti-Japanese Free Thai resistance movement was gaining grass-roots acceptance among the populace, and the government feared that these highly educated and high-ranking prisoners from the old elite would join the resistance if given the opportunity.</p>
<p>For So personally, the prospect of another transfer represented a potentially catastrophic disruption to his scholarly work. The dictionary project that had survived the move from Bang Kwang to Tarutao might not survive another relocation, particularly to an island even more remote and less developed than their current location. The networks of support and communication that had enabled the project’s continuation would have to be reconstructed under even more difficult circumstances.</p>
</section>
<section id="the-broader-context-of-wartime-transformation" class="level2">
<h2 class="anchored" data-anchor-id="the-broader-context-of-wartime-transformation">The Broader Context of Wartime Transformation</h2>
<p>The war’s impact on the political prisoners was part of a much broader transformation of Thai society under the pressures of global conflict. The kingdom that had entered the war reluctantly found itself increasingly militarized as the demands of alliance with Japan required ever-greater sacrifices from the Thai people. Traditional patterns of social and economic life were disrupted as resources were redirected to military purposes and civilian activities were subordinated to wartime necessities.</p>
<p>The intellectual and cultural life that had begun to flourish during the 1920s and early 1930s was particularly hard hit by wartime pressures. Educational institutions found their resources reduced and their curricula altered to emphasize military training and nationalist indoctrination. Cultural organizations were disbanded or placed under strict government control. The free exchange of ideas that had characterized Thai intellectual life during the final years of the absolute monarchy became impossible under wartime censorship and surveillance.</p>
<p>For the Western-educated elite, whether imprisoned or free, the war represented the final destruction of the world they had known and the values they had cherished. The international outlook that had once been valued as an asset for national development was now viewed as evidence of insufficient loyalty to the Thai nation. The cosmopolitan culture they had created was denounced as foreign contamination that weakened national resolve.</p>
<p>The dictionary project that So continued to pursue under these circumstances represented more than personal scholarly ambition; it was a form of cultural resistance against the narrowing of intellectual horizons that wartime nationalism demanded. By maintaining his commitment to bridging Thai and English cultures through educational resources, So was preserving possibilities for future cultural exchange that the current political climate sought to eliminate.</p>
<p>As we shall see in <strong>?@sec-survival-perseverance</strong>, the transfer to Koh Tao would test So’s resilience and determination under conditions even more challenging than those he had previously endured. The island that would become their final prison would subject the remaining political prisoners to hardships that would claim several lives and bring So himself to the brink of physical collapse. Yet even under these extreme circumstances, his commitment to completing his life’s work would demonstrate the remarkable capacity of intellectual dedication to transcend the most severe forms of physical and psychological pressure.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>