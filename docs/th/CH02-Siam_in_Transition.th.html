<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ch02-siam_in_transition.th – The Dictionary Maker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="sec-siam-transition" class="level1">
<h1>Siam in Transition</h1>
<section id="from-absolute-monarchy-to-constitutional-rule" class="level2">
<h2 class="anchored" data-anchor-id="from-absolute-monarchy-to-constitutional-rule">From Absolute Monarchy to Constitutional Rule</h2>
<p>The transformation of Siam from an absolute monarchy to a constitutional system in 1932 marked the end of an era and the beginning of profound social and political upheaval.</p>
<p>By the 1920s, the kingdom that had shaped So Sethaputra (as described in <strong>?@sec-last-siamese</strong>) was already showing signs of internal strain. The confident modernization programs of Kings Chulalongkorn and Vajiravudh had created new institutions, new classes, and new expectations that were beginning to challenge the traditional order. What had seemed like organic evolution was revealing itself to be revolutionary transformation in disguise.</p>
<p>The Siam of the early twentieth century was a society caught between worlds. Ancient Buddhist temples stood beside modern government buildings designed in European architectural styles. Traditional markets operated in the shadow of new department stores. Rice farmers using techniques unchanged for centuries worked lands connected to Bangkok by railways that had reduced journey times from weeks to hours. This was a kingdom in the midst of perhaps the most rapid transformation in its long history, yet few recognized how fundamentally the changes would alter the nature of power and authority.</p>
</section>
<section id="the-great-transformation" class="level2">
<h2 class="anchored" data-anchor-id="the-great-transformation">The Great Transformation</h2>
<p>The modernization that began under King Chulalongkorn in the 1870s had been driven by external necessity. Faced with the colonial expansion of Britain and France in Southeast Asia, Siam’s leaders recognized that survival required adaptation. The kingdom could preserve its independence only by demonstrating that it was a modern, civilized state worthy of respect by European powers. This meant adopting Western-style administration, legal systems, and educational institutions while carefully preserving the essential symbols and structures of traditional authority.</p>
<p>The transformation was remarkable in its scope and speed. Ancient forms of corvée labor were abolished and replaced with modern taxation systems. Provincial governors who had ruled like feudal lords were replaced by salaried civil servants answerable to Bangkok. The traditional legal system, based on Buddhist principles and customary law, gave way to codes modeled on European jurisprudence. Most dramatically, slavery was gradually abolished, freeing hundreds of thousands of people who had been bound to the land or to noble households for generations.</p>
<p>These changes created new social dynamics that the monarchy struggled to control. The new civil service attracted ambitious young men from families that had never before had access to power. Western education, initially seen as a tool for strengthening the traditional order, began to produce graduates who questioned that very order. The introduction of printing presses and newspapers created public spaces for political discussion that had never existed in traditional Siam.</p>
<p>By the 1920s, Bangkok had become a cosmopolitan city where traditional Thai wooden houses stood beside modern concrete buildings, where Buddhist monks in saffron robes walked streets filled with automobiles, where traditional shadow puppet performances competed with imported films from Hollywood. The capital was home to Western-educated intellectuals, Chinese merchants, European advisors, and a growing middle class that belonged fully to neither the traditional world nor the modern one.</p>
</section>
<section id="the-pressure-of-new-ideas" class="level2">
<h2 class="anchored" data-anchor-id="the-pressure-of-new-ideas">The Pressure of New Ideas</h2>
<p>The generation of Thai students who went abroad to study in the 1900s and 1910s returned home with more than technical expertise. They had absorbed ideas about democracy, nationalism, and popular sovereignty that were fundamentally incompatible with absolute monarchy. Unlike the generation that included So Sethaputra, who saw constitutional monarchy as a natural evolution of traditional kingship, these younger intellectuals began to question whether monarchy itself was compatible with modern civilization.</p>
<p>European universities had exposed them to the great political movements of the age: liberalism, socialism, nationalism, and republicanism. They had witnessed the dramatic political changes following World War I, when ancient empires collapsed and new nations emerged based on principles of popular sovereignty. The Russian Revolution of 1917 had shown that even the most autocratic regimes could be overthrown by determined revolutionaries. The Chinese Revolution of 1911 had demonstrated that Asian societies could successfully adopt republican forms of government.</p>
<p>These ideas fermented in the coffee houses and student organizations of Bangkok, creating an intellectual underground that grew increasingly impatient with the pace of political reform. While older intellectuals like So Sethaputra believed in gradual, organic change that would preserve the best elements of traditional society, younger radicals saw the monarchy as an obstacle to genuine modernization.</p>
<p>The tension was particularly acute among military officers, who had been exposed to Western military organization and doctrine during their training. They had learned that modern armies were citizens’ armies, motivated by patriotism rather than personal loyalty to a monarch. They had studied the military reforms that had made Prussia, Japan, and other nations great powers. Many came to believe that Siam’s continued weakness and dependence on foreign advisors was the direct result of an outdated political system that concentrated power in the hands of a traditional elite rather than distributing it among the most capable and patriotic citizens.</p>
</section>
<section id="economic-pressures-and-social-change" class="level2">
<h2 class="anchored" data-anchor-id="economic-pressures-and-social-change">Economic Pressures and Social Change</h2>
<p>The global economic crisis that began in 1929 exposed the vulnerabilities of Siam’s modernization program. The kingdom’s economy remained heavily dependent on rice exports, making it vulnerable to fluctuations in world commodity prices. When rice prices collapsed in the early 1930s, the government found itself facing a severe fiscal crisis just as demands for public services and infrastructure investment were increasing.</p>
<p>The economic pressure fell most heavily on the new middle classes that had emerged during the modernization period. Government salaries were cut, public works projects were canceled, and opportunities for advancement within the bureaucracy became increasingly scarce. Young men who had invested in Western education found themselves competing for a shrinking number of positions, while the traditional elite seemed insulated from the economic hardship by their inherited wealth and privileged access to the highest levels of government.</p>
<p>The contrast between the government’s fiscal austerity and the continued lavish spending of the royal court became increasingly obvious and offensive to struggling middle-class families. While civil servants saw their salaries reduced, the monarchy continued to maintain multiple palaces, support hundreds of dependents, and fund elaborate ceremonies that seemed irrelevant to the kingdom’s pressing needs.</p>
<p>Rural areas experienced their own forms of economic distress. Peasant farmers, already burdened by new taxes and increasingly integrated into a cash economy, found themselves unable to cope with falling crop prices and rising costs for manufactured goods. Traditional patron-client relationships that had provided security in times of hardship were being eroded by the monetization of economic relationships and the centralization of administrative authority in Bangkok.</p>
<p>The Chinese merchant community, which had grown dramatically during the modernization period, became a convenient scapegoat for economic frustrations. Thai nationalism, initially focused on resistance to European colonial pressure, began to turn inward against internal minorities. This xenophobic turn would have important political consequences, as politicians discovered that appeals to ethnic solidarity could mobilize popular support for radical changes that might otherwise have been resisted.</p>
</section>
<section id="the-crisis-of-authority" class="level2">
<h2 class="anchored" data-anchor-id="the-crisis-of-authority">The Crisis of Authority</h2>
<p>By 1930, the traditional sources of political authority in Siam were being challenged from multiple directions. The monarchy’s claim to rule by divine right seemed increasingly anachronistic to Western-educated intellectuals who had absorbed Enlightenment ideas about popular sovereignty. The traditional nobility’s hereditary privileges appeared unjust to middle-class civil servants who believed that merit rather than birth should determine access to power. The Buddhist clergy’s moral authority was being questioned by secular intellectuals who saw religion as an obstacle to scientific progress.</p>
<p>King Prajadhipok, who had ascended to the throne in 1925, was acutely aware of these pressures. Unlike his predecessors, he had not been trained from birth to rule and lacked the personal authority that came from long preparation for kingship. He was intellectually honest enough to recognize the legitimacy of demands for political reform, but he also understood the dangers of moving too quickly in dismantling institutions that had provided stability for centuries.</p>
<p>The king’s own inclinations toward constitutional reform created a paradoxical situation. By acknowledging the need for change, he inadvertently legitimized more radical demands for transformation. His willingness to consider limiting royal power was interpreted by some as weakness and by others as insufficient commitment to genuine democracy. His careful, gradualist approach satisfied neither conservatives who wanted to preserve the traditional system nor radicals who demanded immediate transformation.</p>
<p>The government’s handling of the economic crisis further undermined its authority. Traditional methods of dealing with fiscal problems—raising taxes and reducing expenditures—seemed inadequate to address the structural challenges facing the kingdom. The monarchy’s response to popular distress appeared reactive and ineffective, reinforcing perceptions that the traditional elite were out of touch with the needs of ordinary citizens.</p>
</section>
<section id="intellectual-ferment-and-political-organization" class="level2">
<h2 class="anchored" data-anchor-id="intellectual-ferment-and-political-organization">Intellectual Ferment and Political Organization</h2>
<p>The 1920s and early 1930s witnessed an explosion of intellectual and cultural activity that reflected the kingdom’s political tensions. New magazines and newspapers provided forums for political debate that had been impossible under the old system of absolute monarchy. Literary societies, professional organizations, and study groups created spaces where Western-educated intellectuals could discuss ideas that challenged traditional assumptions about authority and governance.</p>
<p>The introduction of constitutional monarchy was no longer a question of whether but when and how. Even conservative intellectuals recognized that some form of political reform was inevitable. The debate centered on the pace and extent of change: should transformation be gradual and evolutionary, preserving as much as possible of the traditional system while adapting it to modern conditions, or should it be rapid and revolutionary, sweeping away old institutions to make room for entirely new forms of organization?</p>
<p>Students returning from Europe brought with them not only new ideas but also new methods of political organization. They had learned about political parties, labor unions, professional associations, and other forms of collective action that were largely unknown in traditional Siam. Some had participated in student movements and political organizations in their host countries, gaining practical experience in modern forms of political mobilization.</p>
<p>These organizational innovations were particularly important in the military, where young officers began forming secret societies dedicated to political reform. Unlike civilian intellectuals, who had to rely on persuasion and public debate, military officers had access to the means of coercion. Their professional training had taught them to think strategically about the application of force to achieve political objectives. Their command of troops gave them the practical capability to translate ideas into action.</p>
</section>
<section id="the-moment-of-crisis" class="level2">
<h2 class="anchored" data-anchor-id="the-moment-of-crisis">The Moment of Crisis</h2>
<p>By 1932, the various pressures that had been building within Siamese society were approaching a critical point. The economic crisis had created widespread dissatisfaction with the government’s performance. Intellectual ferment had produced a generation of Western-educated leaders who were committed to fundamental political change. Military officers had developed both the ideological commitment and the organizational capability necessary for revolutionary action.</p>
<p>The traditional elite, including figures like So Sethaputra who would later pay the price for their loyalty to the old order, remained largely unaware of how precarious their position had become. They continued to believe in the possibility of gradual reform that would preserve the essential features of the monarchical system while adapting it to modern conditions. This faith in evolutionary change would prove to be their greatest vulnerability when revolutionary change finally arrived.</p>
<p>The stage was set for the confrontation between old and new that would transform Siam into Thailand and reshape the lives of an entire generation. The kingdom that had successfully resisted European colonization would prove unable to resist the internal pressures generated by its own modernization program. The confident synthesis of traditional and modern elements that had characterized the early twentieth century was about to be shattered by forces that neither the monarchy nor its loyal servants had anticipated or prepared to resist.</p>
<p>As we shall see in <strong>?@sec-elite-threat</strong>, the Western-educated intellectuals who had been among the chief beneficiaries of the old system’s modernization program would find themselves among its most prominent victims when the new order finally emerged. The transformation of Siam was about to claim its first casualties among those who had done the most to make it possible.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>