<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ch06-the_dictionary_project_begins – The Dictionary Maker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="sec-dictionary-begins" class="level1">
<h1>The Dictionary Project Begins</h1>
<section id="how-does-one-write-a-dictionary-in-prison" class="level2">
<h2 class="anchored" data-anchor-id="how-does-one-write-a-dictionary-in-prison">“How Does One Write a Dictionary in Prison?”</h2>
<p>Faced with a life sentence and his students’ need for English translation, So Sethaputra embarked on what he called his “Life’s Work” - creating Thailand’s first comprehensive English-Thai dictionary written by a Thai for Thai students.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="_resources/assets/images/ch6-dictionarysample.jpeg" class="img-fluid figure-img"></p>
<figcaption>A sample page from So Sethaputra’s “New Model English-Siamese Dictionary,” showing his innovative approach of using vivid example sentences drawn from current affairs, personal experience, and Thai cultural context to illuminate English word meanings for Thai students.</figcaption>
</figure>
</div>
<p>The question that kept So Sethaputra awake during his first weeks in Bang Kwang prison was deceptively simple yet overwhelmingly complex: “How does one even begin to write a dictionary in prison?” The more he contemplated the practical challenges involved, the more impossible the task seemed. Yet it was precisely this impossibility that made the project so compelling. If he could succeed in creating a comprehensive English-Thai dictionary under such circumstances, he would demonstrate that intellectual achievement could transcend any form of political persecution.</p>
<p>The inspiration for the dictionary had emerged from his teaching experience in Ward Six (as described in <strong>?@sec-prison-university</strong>), but the decision to undertake such an ambitious project required a fundamental reorientation of how So understood his imprisonment. Rather than viewing his life sentence as the end of his productive career, he began to see it as an unprecedented opportunity to focus entirely on scholarly work without the distractions and obligations that had previously limited his intellectual pursuits.</p>
<p>At thirty years old, So possessed the intellectual vigor and psychological resilience necessary for such a demanding undertaking. His years as Royal Spokesman had given him extensive experience with both English and Thai, while his background in journalism had taught him the importance of clear, accessible prose. Most crucially, his teaching experience had shown him exactly what kind of dictionary Thai students needed: not merely a collection of word equivalents, but a comprehensive guide to English language and culture written from a Thai perspective.</p>
</section>
<section id="the-vision-of-a-new-kind-of-dictionary" class="level2">
<h2 class="anchored" data-anchor-id="the-vision-of-a-new-kind-of-dictionary">The Vision of a New Kind of Dictionary</h2>
<p>So’s conception of his dictionary project was revolutionary in its scope and approach. Existing English-Thai dictionaries were typically crude compilations produced by European scholars or missionaries who lacked deep understanding of Thai culture and learning styles. These works treated language as a mechanical process of word substitution, ignoring the cultural contexts that gave words their real meaning and significance.</p>
<p>So envisioned something entirely different: a dictionary that would serve as a bridge between civilizations rather than merely a tool for translation. Each English word would be explained not through dry definitions but through vivid example sentences that illuminated both the word’s meaning and its cultural significance. The dictionary would teach Thai students not just how to translate English words but how to understand the English-speaking world itself.</p>
<p>The sample page that survives from So’s work demonstrates his innovative approach. Rather than providing abstract definitions, he created example sentences that were simultaneously educational and culturally relevant. When defining “abdicate,” he wrote simply: “His Majesty abdicated.” For “absent,” he chose: “Freedom of the press is absent.” The entry for “accuse” read: “They were accused of treason.” Each example was drawn from So’s own experience and reflected the political realities that had shaped his life.</p>
<p>This approach required not just linguistic expertise but profound cultural understanding. So had to comprehend not only what English words meant but how they functioned within English-speaking societies, then find ways to convey that understanding to Thai readers who might never leave their homeland. The dictionary thus became a work of cultural translation as much as linguistic scholarship.</p>
</section>
<section id="the-practical-challenges-of-secret-scholarship" class="level2">
<h2 class="anchored" data-anchor-id="the-practical-challenges-of-secret-scholarship">The Practical Challenges of Secret Scholarship</h2>
<p>The practical obstacles facing So’s dictionary project seemed almost insurmountable. Prison regulations strictly forbade political prisoners from writing anything intended for outside readership beyond personal letters. All correspondence was carefully censored, and any manuscripts discovered by guards would be confiscated and their authors punished. The fundamental problem was not merely writing in secret but finding ways to preserve and transmit the completed work.</p>
<p>So’s solution demonstrated the ingenuity that would characterize his entire approach to the project. He would disguise his dictionary work as part of his English teaching activities in Ward Six. The guards, most of whom were poorly educated and spoke no English, could not distinguish between legitimate classroom materials and dictionary manuscripts. So’s reputation as a dedicated teacher provided perfect cover for his scholarly activities.</p>
<p>The physical challenges were equally daunting. So needed writing materials, reference books, and workspace suitable for sustained intellectual effort. He solved these problems through a combination of resourcefulness and careful negotiation. Writing paper and instruments could be obtained through arrangements with guards who were willing to supplement their meager salaries through small commercial transactions. Reference materials could be borrowed from the Neilson Hays Library or purchased from outside sources under the pretense of supporting his English classes.</p>
<p>Most ingeniously, So designed and constructed a functional writing desk and comfortable chair from packing crates available within the prison. This improvised furniture provided him with a proper workspace that was essential for the meticulous work of dictionary compilation. The psychological importance of having a dedicated study area cannot be overstated; it created a sense of scholarly normalcy that helped maintain his intellectual focus despite the abnormal circumstances of his confinement.</p>
</section>
<section id="the-recruitment-of-collaborators" class="level2">
<h2 class="anchored" data-anchor-id="the-recruitment-of-collaborators">The Recruitment of Collaborators</h2>
<p>The scope of the dictionary project required assistance that So could not provide alone. Fortunately, Ward Six contained numerous educated prisoners who were eager to contribute to meaningful intellectual work. So’s organizational skills and natural leadership abilities enabled him to create an efficient collaborative system that maximized the talents of his fellow inmates while maintaining the secrecy necessary for the project’s survival.</p>
<p>So instituted a strict daily routine that provided structure for both his own work and that of his assistants. The team would begin work at seven-thirty in the morning and continue until lunch break at eleven-thirty, then resume at two-thirty in the afternoon and work until dark. This schedule provided approximately eight hours of productive work time each day, far more than So could have achieved working alone.</p>
<p>The division of labor was carefully planned to utilize each assistant’s particular strengths. Some prisoners excelled at the meticulous physical transcription required to produce clean copies of So’s drafts. Others had beautiful handwriting that was essential for preparing the final manuscript versions. Still others possessed specialized knowledge that could inform particular dictionary entries. The result was a collaborative scholarly enterprise that demonstrated the intellectual vitality of the imprisoned elite.</p>
<p>So’s role in this system was that of the creative brain while his assistants provided the skilled labor necessary to transform his ideas into finished products. Former collaborators would later recall the magical moments when “Sor was the brain and we were the labour. He would sit there, cross-legged, and suddenly burst out with a word or phrase; and we would immediately transcribe it onto paper.” This method allowed So to maintain the creative flow essential for productive scholarship while ensuring that his ideas were immediately captured and preserved.</p>
</section>
<section id="the-critical-role-of-gaysorn" class="level2">
<h2 class="anchored" data-anchor-id="the-critical-role-of-gaysorn">The Critical Role of Gaysorn</h2>
<p>The most dangerous aspect of the entire enterprise was smuggling completed manuscript pages out of the prison past the security checkpoints that separated Ward Six from the outside world. This seemingly impossible task was accomplished through the heroic efforts of So’s mother, Gaysorn, whose devotion to her son’s work made the dictionary project possible.</p>
<p>Gaysorn had remained in Bangkok throughout So’s imprisonment, dedicating her life to supporting his scholarly activities. Her literacy, unusual for women of her generation, made her uniquely qualified to serve as her son’s collaborator and co-conspirator. She understood not only the practical importance of the dictionary project but also its deeper significance as a form of cultural resistance against the revolutionary government that had destroyed her son’s political career.</p>
<p>The smuggling operation required remarkable ingenuity and courage. Gaysorn developed several methods for concealing manuscript pages during her prison visits. Her primary technique involved using the outer cylinder of a large thermos flask to hide rolled-up papers. The false bottom could accommodate several pages at a time, and the device appeared entirely innocent to guards who were accustomed to visitors bringing food and beverages to prisoners.</p>
<p>When the thermos flask method became risky due to repeated use, Gaysorn introduced a false-bottomed basket that could conceal even more material. So must have appreciated the irony when he later wrote the dictionary entry: “false: The documents were concealed under the false bottom of the box.” His mother’s smuggling activities had provided him with perfect real-world examples for his scholarly work.</p>
<p>Over the course of several years, Gaysorn successfully smuggled almost 2,000 pages of manuscript material out of Bang Kwang prison. This represented not merely a logistical achievement but a act of remarkable courage. Discovery would have meant severe punishment for both mother and son, and the complete destruction of years of scholarly work. Her success made possible everything that followed in So’s dictionary project.</p>
</section>
<section id="the-publishing-innovation" class="level2">
<h2 class="anchored" data-anchor-id="the-publishing-innovation">The Publishing Innovation</h2>
<p>By the time So had completed work through the letter “G,” he felt confident enough in the project’s quality and his mother’s smuggling abilities to begin considering publication arrangements. This decision required him to move from purely scholarly concerns to practical questions of marketing and distribution. The challenge was to find a publisher willing to handle material produced by a political prisoner and to develop a distribution system that would not compromise the secrecy essential to the project’s continuation.</p>
<p>So’s solution was to contact Phraya Nibhon Pojanart, owner of Krungdheb Bannakarn, Bangkok’s leading bookstore. Phraya Nibhon was a member of the old elite who had avoided imprisonment but remained sympathetic to the political prisoners’ plight. More importantly, he possessed the commercial expertise and distribution network necessary to bring So’s dictionary to market.</p>
<p>The publishing arrangement that So and Phraya Nibhon developed was brilliant in both its commercial and political aspects. Rather than attempting to publish the complete dictionary at once, which would have required enormous capital investment and created dangerous exposure for all involved, they decided to issue the work in weekly installments over a period of two years. Subscribers could collect the installments and bind them into two volumes totaling 2,400 pages when the series was complete.</p>
<p>This serialization approach solved multiple problems simultaneously. It required minimal upfront investment from the publisher, reducing financial risk and making the project commercially viable. It provided So with regular income throughout his imprisonment, addressing the economic hardship that affected his family. Most importantly, it created plausible deniability for the political aspects of the project.</p>
<p>The official line developed by Phraya Nibhon was that he had commissioned the dictionary from So between 1927 and 1932, well before his imprisonment for political activities. This fiction allowed both publisher and author to avoid charges of conducting illegal business with a political prisoner. The completed portions of the dictionary could be presented as legitimate commercial inventory rather than contraband material produced in violation of prison regulations.</p>
</section>
<section id="the-market-response" class="level2">
<h2 class="anchored" data-anchor-id="the-market-response">The Market Response</h2>
<p>The first installments of “The New Model English-Siamese Dictionary” exceeded all expectations for commercial success. Thai students and intellectuals, starved for high-quality educational materials, embraced So’s work with enthusiasm that surprised even its creators. The dictionary was unlike anything previously available in Thailand, and its innovative approach to English-language instruction filled a crucial gap in the country’s educational resources.</p>
<p>The success owed much to So’s deep understanding of his target audience. Unlike European-produced dictionaries that assumed readers possessed extensive cultural knowledge of the English-speaking world, So’s work was designed specifically for Thai students who were encountering English language and culture for the first time. His example sentences drew on Thai historical experiences, contemporary political events, and cultural references that would be immediately meaningful to his readers.</p>
<p>The commercial success of the early installments provided So with something almost as valuable as income: validation that his years of work were producing something of genuine value to Thai society. The positive market response demonstrated that his scholarly activities were not merely personal therapy or intellectual self-indulgence, but rather a significant contribution to his country’s educational development.</p>
<p>The regular income from dictionary sales also addressed a crucial practical problem. So was supporting not only himself but also his younger brother and sister, who were attending university. The revolutionary government’s destruction of his political career had eliminated his family’s primary source of income, making the dictionary earnings essential for their economic survival. The project thus served both scholarly and practical purposes, demonstrating how intellectual achievement could provide concrete benefits even under the most difficult circumstances.</p>
<p>As we shall see in <strong>?@sec-rising-storm</strong>, So’s dictionary work would continue to evolve and expand even as the broader political situation in Asia deteriorated. The global crisis that would eventually engulf Thailand in world war would create new challenges for the dictionary project, but it would also demonstrate the remarkable resilience of intellectual endeavor in the face of political upheaval. So’s “Life’s Work” had begun as a response to his students’ needs, but it would ultimately become a testament to the power of scholarship to transcend the limitations imposed by political persecution.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>